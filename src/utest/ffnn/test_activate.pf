module test_activate
  use pfunit_mod
  use trncmp_ENV
  use ffnn_network_mod
  use string_tools
  implicit none


    real(dp), parameter :: test_Z(3,3) = reshape([     &
         &     -3.0000000000d-01,  -1.0000000000d-01,  -2.0000000000d-01,     &
         &      0.0000000000d+00,   1.0000000000d-01,  -1.0000000000d-01,     &
         &      3.0000000000d-01,   2.0000000000d-01,   1.0000000000d-01     &
         &    ],[3,3])

    real(dp), parameter :: test_sig_a(3,3) = reshape([     &
         &      4.2555748319d-01,   4.7502081252d-01,   4.5016600269d-01,     &
         &      5.0000000000d-01,   5.2497918748d-01,   4.7502081252d-01,     &
         &      5.7444251681d-01,   5.4983399731d-01,   5.2497918748d-01     &
         &    ],[3,3])

    real(dp), parameter :: test_sig_g(3,3) = reshape([     &
         &      2.4445831169d-01,   2.4937604019d-01,   2.4751657271d-01,     &
         &      2.5000000000d-01,   2.4937604019d-01,   2.4937604019d-01,     &
         &      2.4445831169d-01,   2.4751657271d-01,   2.4937604019d-01     &
         &    ],[3,3])

    real(dp), parameter :: test_rel_a(3,3) = reshape([     &
         &      0.0000000000d+00,   0.0000000000d+00,   0.0000000000d+00,     &
         &      0.0000000000d+00,   1.0000000000d-01,   0.0000000000d+00,     &
         &      3.0000000000d-01,   2.0000000000d-01,   1.0000000000d-01     &
         &    ],[3,3])

    real(dp), parameter :: test_rel_g(3,3) = reshape([     &
         &      0.0000000000d+00,   0.0000000000d+00,   0.0000000000d+00,     &
         &      1.0000000000d+00,   1.0000000000d+00,   0.0000000000d+00,     &
         &      1.0000000000d+00,   1.0000000000d+00,   1.0000000000d+00     &
         &    ],[3,3])

    real(dp), parameter :: test_tan_a(3,3) = reshape([     &
         &     -2.9131261245d-01,  -9.9667994625d-02,  -1.9737532022d-01,     &
         &      0.0000000000d+00,   9.9667994625d-02,  -9.9667994625d-02,     &
         &      2.9131261245d-01,   1.9737532022d-01,   9.9667994625d-02     &
         &    ],[3,3])

    real(dp), parameter :: test_tan_g(3,3) = reshape([     &
         &      9.1513696183d-01,   9.9006629085d-01,   9.6104298297d-01,     &
         &      1.0000000000d+00,   9.9006629085d-01,   9.9006629085d-01,     &
         &      9.1513696183d-01,   9.6104298297d-01,   9.9006629085d-01     &
         &    ],[3,3])

    real(dp), parameter :: test_lin_a(3,3) = reshape([     &
         &     -3.0000000000d-01,  -1.0000000000d-01,  -2.0000000000d-01,     &
         &      0.0000000000d+00,   1.0000000000d-01,  -1.0000000000d-01,     &
         &      3.0000000000d-01,   2.0000000000d-01,   1.0000000000d-01     &
         &    ],[3,3])

    real(dp), parameter :: test_lin_g(3,3) = reshape([     &
         &      1.0000000000d+00,   1.0000000000d+00,   1.0000000000d+00,     &
         &      1.0000000000d+00,   1.0000000000d+00,   1.0000000000d+00,     &
         &      1.0000000000d+00,   1.0000000000d+00,   1.0000000000d+00     &
         &    ],[3,3])

   real(dp), parameter :: test_gau_a(3,3) = reshape([     &
         &      9.5599748183d-01,   9.9501247919d-01,   9.8019867331d-01,     &
         &      1.0000000000d+00,   9.9501247919d-01,   9.9501247919d-01,     &
         &      9.5599748183d-01,   9.8019867331d-01,   9.9501247919d-01     &
         &    ],[3,3])

    real(dp), parameter :: test_gau_g(3,3) = reshape([     &
         &      2.8679924455d-01,   9.9501247919d-02,   1.9603973466d-01,     &
         &     -0.0000000000d+00,  -9.9501247919d-02,   9.9501247919d-02,     &
         &     -2.8679924455d-01,  -1.9603973466d-01,  -9.9501247919d-02     &
         &    ],[3,3])

  contains





  @test
  !/ =====================================================================================
  subroutine test_activate_sigma
    !/ -----------------------------------------------------------------------------------
    implicit none
    procedure(ActivateFunction),  pointer :: act
    procedure(DActivateFunction), pointer :: dact
    integer  :: r,c,nr,nc
    real(dp), allocatable :: a(:,:), g(:,:)
    !/ -----------------------------------------------------------------------------------
    nr = size( test_Z, DIM=1 )
    nc = size( test_Z, DIM=2 )

    allocate( a(nr,nc) )
    allocate( g(nr,nc) )

    act  => getActivation( 'sigma' )
    dact => getDActivation( 'sigma' )

    do concurrent( r=1:nr, c=1:nc )
       a(r,c) = act( test_Z(r,c) )
    end do

    do concurrent( r=1:nr, c=1:nc )
       g(r,c) = dact( a(r,c), test_Z(r,c) )
    end do

    @assertEqual( test_sig_a, a, 1.0d-10 )
    @assertEqual( test_sig_g, g, 1.0d-11 )

    deallocate( a )
    deallocate( g )

  end subroutine test_activate_sigma



end module test_activate
